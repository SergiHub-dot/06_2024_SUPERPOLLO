SELECT P.CODIGO, 
               P.FECHA_HORA, 
               P.ESTADO,
               E.NOMBRE_COMERCIAL,
               ROUND( SUM(LP.PRECIO * LP.CANTIDAD), 2 ) AS TOTAL_PEDIDO,
               COUNT(P.CODIGO) AS NUMERO_LINEAS
   FROM PEDIDOS P JOIN ESTABLECIMIENTOS E ON (P.CODIGO_ESTABLECIMIENTO = E.CODIGO) JOIN LINEAS_PEDIDO LP ON (LP.CODIGO_PEDIDO = P.CODIGO) 
GROUP BY P.CODIGO